F.module("/static/common/ui/rangy/rangy.js",function(b,a){window.rangy=(function(){var l="object",i="function",B="undefined";var m=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer","START_TO_START","START_TO_END","END_TO_START","END_TO_END"];var e=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"];var t=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"];var q=["collapse","compareEndPoints","duplicate","getBookmark","moveToBookmark","moveToElementText","parentElement","pasteHTML","select","setEndPoint","getBoundingClientRect"];function k(E,D){var C=typeof E[D];return C==i||(!!(C==l&&E[D]))||C=="unknown"}function f(D,C){return !!(typeof D[C]==l&&D[C])}function r(D,C){return typeof D[C]!=B}function n(C){return function(G,E){var D=E.length;while(D--){if(!C(G,E[D])){return false}}return true}}var p=n(k);var s=n(f);var A=n(r);function w(C){return C&&p(C,q)&&A(C,t)}var o={version:"1.2.3",initialized:false,supported:true,util:{isHostMethod:k,isHostObject:f,isHostProperty:r,areHostMethods:p,areHostObjects:s,areHostProperties:A,isTextRange:w},features:{},modules:{},config:{alertOnWarn:false,preferTextRange:false}};function h(C){window.alert("Rangy not supported in your browser. Reason: "+C);o.initialized=true;o.supported=false}o.fail=h;function v(D){var C="Rangy warning: "+D;if(o.config.alertOnWarn){window.alert(C)}else{if(typeof window.console!=B&&typeof window.console.log!=B){window.console.log(C)}}}o.warn=v;if({}.hasOwnProperty){o.util.extend=function(E,D){for(var C in D){if(D.hasOwnProperty(C)){E[C]=D[C]}}}}else{h("hasOwnProperty not supported")}var x=[];var c=[];function u(){if(o.initialized){return}var E;var J=false,K=false;if(k(document,"createRange")){E=document.createRange();if(p(E,e)&&A(E,m)){J=true}E.detach()}var D=f(document,"body")?document.body:document.getElementsByTagName("body")[0];if(D&&k(D,"createTextRange")){E=D.createTextRange();if(w(E)){K=true}}if(!J&&!K){h("Neither Range nor TextRange are implemented")}o.initialized=true;o.features={implementsDomRange:J,implementsTextRange:K};var I=c.concat(x);for(var H=0,C=I.length;H<C;++H){try{I[H](o)}catch(G){if(f(window,"console")&&k(window.console,"log")){window.console.log("Init listener threw an exception. Continuing.",G)}}}}o.init=u;o.addInitListener=function(C){if(o.initialized){C(o)}else{x.push(C)}};var y=[];o.addCreateMissingNativeApiListener=function(C){y.push(C)};function g(E){E=E||window;u();for(var D=0,C=y.length;D<C;++D){y[D](E)}}o.createMissingNativeApi=g;function z(C){this.name=C;this.initialized=false;this.supported=false}z.prototype.fail=function(C){this.initialized=true;this.supported=false;throw new Error("Module '"+this.name+"' failed to load: "+C)};z.prototype.warn=function(C){o.warn("Module "+this.name+": "+C)};z.prototype.createError=function(C){return new Error("Error in Rangy "+this.name+" module: "+C)};o.createModule=function(C,E){var D=new z(C);o.modules[C]=D;c.push(function(G){E(G,D);D.initialized=true;D.supported=true})};o.requireModules=function(E){for(var H=0,C=E.length,G,D;H<C;++H){D=E[H];G=o.modules[D];if(!G||!(G instanceof z)){throw new Error("Module '"+D+"' not found")}if(!G.supported){throw new Error("Module '"+D+"' not supported")}}};var d=false;var j=function(C){if(!d){d=true;if(!o.initialized){u()}}};if(typeof window==B){h("No window found");return}if(typeof document==B){h("No document found");return}if(k(document,"addEventListener")){document.addEventListener("DOMContentLoaded",j,false)}if(k(window,"addEventListener")){window.addEventListener("load",j,false)}else{if(k(window,"attachEvent")){window.attachEvent("onload",j)}else{h("Window does not have required addEventListener or attachEvent method")}}return o})();rangy.createModule("DomUtil",function(r,f){var v="undefined";var d=r.util;if(!d.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])){f.fail("document missing a Node creation method")}if(!d.isHostMethod(document,"getElementsByTagName")){f.fail("document missing getElementsByTagName method")}var g=document.createElement("div");if(!d.areHostMethods(g,["insertBefore","appendChild","cloneNode"]||!d.areHostObjects(g,["previousSibling","nextSibling","childNodes","parentNode"]))){f.fail("Incomplete Element implementation")}if(!d.isHostProperty(g,"innerHTML")){f.fail("Element is missing innerHTML property")}var u=document.createTextNode("test");if(!d.areHostMethods(u,["splitText","deleteData","insertData","appendData","cloneNode"]||!d.areHostObjects(g,["previousSibling","nextSibling","childNodes","parentNode"])||!d.areHostProperties(u,["data"]))){f.fail("Incomplete Text Node implementation")}var A=function(H,J){var I=H.length;while(I--){if(H[I]===J){return true}}return false};function k(I){var H;return typeof I.namespaceURI==v||((H=I.namespaceURI)===null||H=="http://www.w3.org/1999/xhtml")}function l(I){var H=I.parentNode;return(H.nodeType==1)?H:null}function c(I){var H=0;while((I=I.previousSibling)){H++}return H}function i(H){var I;return o(H)?H.length:((I=H.childNodes)?I.length:0)}function z(I,H){var J=[],K;for(K=I;K;K=K.parentNode){J.push(K)}for(K=H;K;K=K.parentNode){if(A(J,K)){return K}}return null}function E(H,I,K){var J=K?I:I.parentNode;while(J){if(J===H){return true}else{J=J.parentNode}}return false}function B(I,H,L){var J,K=L?I:I.parentNode;while(K){J=K.parentNode;if(J===H){return K}K=J}return null}function o(I){var H=I.nodeType;return H==3||H==4||H==8}function x(K,I){var H=I.nextSibling,J=I.parentNode;if(H){J.insertBefore(K,H)}else{J.appendChild(K)}return K}function y(J,H){var I=J.cloneNode(false);I.deleteData(0,H);J.deleteData(H,J.length-H);x(I,J);return I}function s(H){if(H.nodeType==9){return H}else{if(typeof H.ownerDocument!=v){return H.ownerDocument}else{if(typeof H.document!=v){return H.document}else{if(H.parentNode){return s(H.parentNode)}else{throw new Error("getDocument: no document found for node")}}}}}function n(H){var I=s(H);if(typeof I.defaultView!=v){return I.defaultView}else{if(typeof I.parentWindow!=v){return I.parentWindow}else{throw new Error("Cannot get a window object for node")}}}function D(H){if(typeof H.contentDocument!=v){return H.contentDocument}else{if(typeof H.contentWindow!=v){return H.contentWindow.document}else{throw new Error("getIframeWindow: No Document object found for iframe element")}}}function h(H){if(typeof H.contentWindow!=v){return H.contentWindow}else{if(typeof H.contentDocument!=v){return H.contentDocument.defaultView}else{throw new Error("getIframeWindow: No Window object found for iframe element")}}}function G(H){return d.isHostObject(H,"body")?H.body:H.getElementsByTagName("body")[0]}function e(I){var H;while((H=I.parentNode)){I=H}return I}function t(K,M,J,L){var H,N,P,O,I;if(K==J){return M===L?0:(M<L)?-1:1}else{if((H=B(J,K,true))){return M<=c(H)?-1:1}else{if((H=B(K,J,true))){return c(H)<L?-1:1}else{N=z(K,J);P=(K===N)?N:B(K,N,true);O=(J===N)?N:B(J,N,true);if(P===O){throw new Error("comparePoints got to case 4 and childA and childB are the same!")}else{I=N.firstChild;while(I){if(I===P){return -1}else{if(I===O){return 1}}I=I.nextSibling}throw new Error("Should not be here!")}}}}}function C(I){var H=s(I).createDocumentFragment(),J;while((J=I.firstChild)){H.appendChild(J)}return H}function q(H){if(!H){return"[No node]"}if(o(H)){return'"'+H.data+'"'}else{if(H.nodeType==1){var I=H.id?' id="'+H.id+'"':"";return"<"+H.nodeName+I+">["+H.childNodes.length+"]"}else{return H.nodeName}}}function p(H){this.root=H;this._next=H}p.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){var J=this._current=this._next;var I,H;if(this._current){I=J.firstChild;if(I){this._next=I}else{H=null;while((J!==this.root)&&!(H=J.nextSibling)){J=J.parentNode}this._next=H}}return this._current},detach:function(){this._current=this._next=this.root=null}};function j(H){return new p(H)}function m(H,I){this.node=H;this.offset=I}m.prototype={equals:function(H){return this.node===H.node&this.offset==H.offset},inspect:function(){return"[DomPosition("+q(this.node)+":"+this.offset+")]"}};function w(H){this.code=this[H];this.codeName=H;this.message="DOMException: "+this.codeName}w.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11};w.prototype.toString=function(){return this.message};r.dom={arrayContains:A,isHtmlNamespace:k,parentElement:l,getNodeIndex:c,getNodeLength:i,getCommonAncestor:z,isAncestorOf:E,getClosestAncestorIn:B,isCharacterDataNode:o,insertAfter:x,splitDataNode:y,getDocument:s,getWindow:n,getIframeWindow:h,getIframeDocument:D,getBody:G,getRootContainer:e,comparePoints:t,inspectNode:q,fragmentFromNodeChildren:C,createIterator:j,DomPosition:m};r.DOMException=w});rangy.createModule("DomRange",function(k,h){k.requireModules(["DomUtil"]);var d=k.dom;var H=d.DomPosition;var X=k.DOMException;function z(ap,e){return(ap.nodeType!=3)&&(d.isAncestorOf(ap,e.startContainer,true)||d.isAncestorOf(ap,e.endContainer,true))}function o(e){return d.getDocument(e.startContainer)}function w(ap,au,aq){var at=ap._listeners[au];if(at){for(var ar=0,e=at.length;ar<e;++ar){at[ar].call(ap,{target:ap,args:aq})}}}function C(e){return new H(e.parentNode,d.getNodeIndex(e))}function aa(e){return new H(e.parentNode,d.getNodeIndex(e)+1)}function l(ap,ar,aq){var e=ap.nodeType==11?ap.firstChild:ap;if(d.isCharacterDataNode(ar)){if(aq==ar.length){d.insertAfter(ap,ar)}else{ar.parentNode.insertBefore(ap,aq==0?ar:d.splitDataNode(ar,aq))}}else{if(aq>=ar.childNodes.length){ar.appendChild(ap)}else{ar.insertBefore(ap,ar.childNodes[aq])}}return e}function K(aq){var ap;for(var ar,at=o(aq.range).createDocumentFragment(),e;ar=aq.next();){ap=aq.isPartiallySelectedSubtree();ar=ar.cloneNode(!ap);if(ap){e=aq.getSubtreeIterator();ar.appendChild(K(e));e.detach(true)}if(ar.nodeType==10){throw new X("HIERARCHY_REQUEST_ERR")}at.appendChild(ar)}return at}function Z(ap,at,e){var aq,av;e=e||{stop:false};for(var ar,au;ar=ap.next();){if(ap.isPartiallySelectedSubtree()){if(at(ar)===false){e.stop=true;return}else{au=ap.getSubtreeIterator();Z(au,at,e);au.detach(true);if(e.stop){return}}}else{aq=d.createIterator(ar);while((av=aq.next())){if(at(av)===false){e.stop=true;return}}}}}function p(ap){var e;while(ap.next()){if(ap.isPartiallySelectedSubtree()){e=ap.getSubtreeIterator();p(e);e.detach(true)}else{ap.remove()}}}function U(ap){for(var aq,ar=o(ap.range).createDocumentFragment(),e;aq=ap.next();){if(ap.isPartiallySelectedSubtree()){aq=aq.cloneNode(false);e=ap.getSubtreeIterator();aq.appendChild(U(e));e.detach(true)}else{ap.remove()}if(aq.nodeType==10){throw new X("HIERARCHY_REQUEST_ERR")}ar.appendChild(aq)}return ar}function r(aq,e,ar){var au=!!(e&&e.length),at;var av=!!ar;if(au){at=new RegExp("^("+e.join("|")+")$")}var ap=[];Z(new i(aq,false),function(aw){if((!au||at.test(aw.nodeType))&&(!av||ar(aw))){ap.push(aw)}});return ap}function B(e){var ap=(typeof e.getName=="undefined")?"Range":e.getName();return"["+ap+"("+d.inspectNode(e.startContainer)+":"+e.startOffset+", "+d.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function i(aq,ap){this.range=aq;this.clonePartiallySelectedTextNodes=ap;if(!aq.collapsed){this.sc=aq.startContainer;this.so=aq.startOffset;this.ec=aq.endContainer;this.eo=aq.endOffset;var e=aq.commonAncestorContainer;if(this.sc===this.ec&&d.isCharacterDataNode(this.sc)){this.isSingleCharacterDataNode=true;this._first=this._last=this._next=this.sc}else{this._first=this._next=(this.sc===e&&!d.isCharacterDataNode(this.sc))?this.sc.childNodes[this.so]:d.getClosestAncestorIn(this.sc,e,true);this._last=(this.ec===e&&!d.isCharacterDataNode(this.ec))?this.ec.childNodes[this.eo-1]:d.getClosestAncestorIn(this.ec,e,true)}}}i.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:false,reset:function(){this._current=null;this._next=this._first},hasNext:function(){return !!this._next},next:function(){var e=this._current=this._next;if(e){this._next=(e!==this._last)?e.nextSibling:null;if(d.isCharacterDataNode(e)&&this.clonePartiallySelectedTextNodes){if(e===this.ec){(e=e.cloneNode(true)).deleteData(this.eo,e.length-this.eo)}if(this._current===this.sc){(e=e.cloneNode(true)).deleteData(0,this.so)}}}return e},remove:function(){var ap=this._current,aq,e;if(d.isCharacterDataNode(ap)&&(ap===this.sc||ap===this.ec)){aq=(ap===this.sc)?this.so:0;e=(ap===this.ec)?this.eo:ap.length;if(aq!=e){ap.deleteData(aq,e-aq)}}else{if(ap.parentNode){ap.parentNode.removeChild(ap)}else{}}},isPartiallySelectedSubtree:function(){var e=this._current;return z(e,this.range)},getSubtreeIterator:function(){var ap;if(this.isSingleCharacterDataNode){ap=this.range.cloneRange();ap.collapse()}else{ap=new an(o(this.range));var au=this._current;var ar=au,e=0,at=au,aq=d.getNodeLength(au);if(d.isAncestorOf(au,this.sc,true)){ar=this.sc;e=this.so}if(d.isAncestorOf(au,this.ec,true)){at=this.ec;aq=this.eo}G(ap,ar,e,at,aq)}return new i(ap,this.clonePartiallySelectedTextNodes)},detach:function(e){if(e){this.range.detach()}this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};function S(e){this.code=this[e];this.codeName=e;this.message="RangeException: "+this.codeName}S.prototype={BAD_BOUNDARYPOINTS_ERR:1,INVALID_NODE_TYPE_ERR:2};S.prototype.toString=function(){return this.message};function y(ap,e,aq){this.nodes=r(ap,e,aq);this._next=this.nodes[0];this._position=0}y.prototype={_current:null,hasNext:function(){return !!this._next},next:function(){this._current=this._next;this._next=this.nodes[++this._position];return this._current},detach:function(){this._current=this._next=this.nodes=null}};var ai=[1,3,4,5,7,8,10];var ag=[2,9,11];var D=[5,6,10,12];var P=[1,3,4,5,7,8,10,11];var I=[1,3,4,5,7,8];function ac(e){return function(aq,at){var ap,ar=at?aq:aq.parentNode;while(ar){ap=ar.nodeType;if(d.arrayContains(e,ap)){return ar}ar=ar.parentNode}return null}}var v=d.getRootContainer;var L=ac([9,11]);var N=ac(D);var f=ac([6,10,12]);function t(ap,e){if(f(ap,e)){throw new S("INVALID_NODE_TYPE_ERR")}}function E(e){if(!e.startContainer){throw new X("INVALID_STATE_ERR")}}function Y(e,ap){if(!d.arrayContains(ap,e.nodeType)){throw new S("INVALID_NODE_TYPE_ERR")}}function ah(e,ap){if(ap<0||ap>(d.isCharacterDataNode(e)?e.length:e.childNodes.length)){throw new X("INDEX_SIZE_ERR")}}function g(ap,e){if(L(ap,true)!==L(e,true)){throw new X("WRONG_DOCUMENT_ERR")}}function ae(e){if(N(e,true)){throw new X("NO_MODIFICATION_ALLOWED_ERR")}}function al(ap,e){if(!ap){throw new X(e)}}function q(e){return !d.arrayContains(ag,e.nodeType)&&!L(e,true)}function ao(e,ap){return ap<=(d.isCharacterDataNode(e)?e.length:e.childNodes.length)}function R(e){return(!!e.startContainer&&!!e.endContainer&&!q(e.startContainer)&&!q(e.endContainer)&&ao(e.startContainer,e.startOffset)&&ao(e.endContainer,e.endOffset))}function j(e){E(e);if(!R(e)){throw new Error("Range error: Range is no longer valid after DOM mutation ("+e.inspect()+")")}}var c=document.createElement("style");var T=false;try{c.innerHTML="<b>x</b>";T=(c.firstChild.nodeType==3)}catch(ak){}k.features.htmlParsingConforms=T;var V=T?function(aq){var ap=this.startContainer;var ar=d.getDocument(ap);if(!ap){throw new X("INVALID_STATE_ERR")}var e=null;if(ap.nodeType==1){e=ap}else{if(d.isCharacterDataNode(ap)){e=d.parentElement(ap)}}if(e===null||(e.nodeName=="HTML"&&d.isHtmlNamespace(d.getDocument(e).documentElement)&&d.isHtmlNamespace(e))){e=ar.createElement("body")}else{e=e.cloneNode(false)}e.innerHTML=aq;return d.fragmentFromNodeChildren(e)}:function(ap){E(this);var aq=o(this);var e=aq.createElement("body");e.innerHTML=ap;return d.fragmentFromNodeChildren(e)};var O=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"];var n=0,A=1,aj=2,ad=3;var u=0,x=1,M=2,m=3;function af(){}af.prototype={attachListener:function(e,ap){this._listeners[e].push(ap)},compareBoundaryPoints:function(au,aq){j(this);g(this.startContainer,aq.startContainer);var aw,ap,av,e;var at=(au==ad||au==n)?"start":"end";var ar=(au==A||au==n)?"start":"end";aw=this[at+"Container"];ap=this[at+"Offset"];av=aq[ar+"Container"];e=aq[ar+"Offset"];return d.comparePoints(aw,ap,av,e)},insertNode:function(ap){j(this);Y(ap,P);ae(this.startContainer);if(d.isAncestorOf(ap,this.startContainer,true)){throw new X("HIERARCHY_REQUEST_ERR")}var e=l(ap,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){j(this);var aq,ap;if(this.collapsed){return o(this).createDocumentFragment()}else{if(this.startContainer===this.endContainer&&d.isCharacterDataNode(this.startContainer)){aq=this.startContainer.cloneNode(true);aq.data=aq.data.slice(this.startOffset,this.endOffset);ap=o(this).createDocumentFragment();ap.appendChild(aq);return ap}else{var e=new i(this,true);aq=K(e);e.detach()}return aq}},canSurroundContents:function(){j(this);ae(this.startContainer);ae(this.endContainer);var e=new i(this,true);var ap=(e._first&&(z(e._first,this))||(e._last&&z(e._last,this)));e.detach();return !ap},surroundContents:function(ap){Y(ap,I);if(!this.canSurroundContents()){throw new S("BAD_BOUNDARYPOINTS_ERR")}var e=this.extractContents();if(ap.hasChildNodes()){while(ap.lastChild){ap.removeChild(ap.lastChild)}}l(ap,this.startContainer,this.startOffset);ap.appendChild(e);this.selectNode(ap)},cloneRange:function(){j(this);var e=new an(o(this));var ap=O.length,aq;while(ap--){aq=O[ap];e[aq]=this[aq]}return e},toString:function(){j(this);var ap=this.startContainer;if(ap===this.endContainer&&d.isCharacterDataNode(ap)){return(ap.nodeType==3||ap.nodeType==4)?ap.data.slice(this.startOffset,this.endOffset):""}else{var aq=[],e=new i(this,true);Z(e,function(ar){if(ar.nodeType==3||ar.nodeType==4){aq.push(ar.data)}});e.detach();return aq.join("")}},compareNode:function(aq){j(this);var ap=aq.parentNode;var at=d.getNodeIndex(aq);if(!ap){throw new X("NOT_FOUND_ERR")}var ar=this.comparePoint(ap,at),e=this.comparePoint(ap,at+1);if(ar<0){return(e>0)?M:u}else{return(e>0)?x:m}},comparePoint:function(e,ap){j(this);al(e,"HIERARCHY_REQUEST_ERR");g(e,this.startContainer);if(d.comparePoints(e,ap,this.startContainer,this.startOffset)<0){return -1}else{if(d.comparePoints(e,ap,this.endContainer,this.endOffset)>0){return 1}}return 0},createContextualFragment:V,toHtml:function(){j(this);var e=o(this).createElement("div");e.appendChild(this.cloneContents());return e.innerHTML},intersectsNode:function(ar,e){j(this);al(ar,"NOT_FOUND_ERR");if(d.getDocument(ar)!==o(this)){return false}var aq=ar.parentNode,au=d.getNodeIndex(ar);al(aq,"NOT_FOUND_ERR");var at=d.comparePoints(aq,au,this.endContainer,this.endOffset),ap=d.comparePoints(aq,au+1,this.startContainer,this.startOffset);return e?at<=0&&ap>=0:at<0&&ap>0},isPointInRange:function(e,ap){j(this);al(e,"HIERARCHY_REQUEST_ERR");g(e,this.startContainer);return(d.comparePoints(e,ap,this.startContainer,this.startOffset)>=0)&&(d.comparePoints(e,ap,this.endContainer,this.endOffset)<=0)},intersectsRange:function(ap,e){j(this);if(o(ap)!=o(this)){throw new X("WRONG_DOCUMENT_ERR")}var ar=d.comparePoints(this.startContainer,this.startOffset,ap.endContainer,ap.endOffset),aq=d.comparePoints(this.endContainer,this.endOffset,ap.startContainer,ap.startOffset);return e?ar<=0&&aq>=0:ar<0&&aq>0},intersection:function(e){if(this.intersectsRange(e)){var ar=d.comparePoints(this.startContainer,this.startOffset,e.startContainer,e.startOffset),ap=d.comparePoints(this.endContainer,this.endOffset,e.endContainer,e.endOffset);var aq=this.cloneRange();if(ar==-1){aq.setStart(e.startContainer,e.startOffset)}if(ap==1){aq.setEnd(e.endContainer,e.endOffset)}return aq}return null},union:function(e){if(this.intersectsRange(e,true)){var ap=this.cloneRange();if(d.comparePoints(e.startContainer,e.startOffset,this.startContainer,this.startOffset)==-1){ap.setStart(e.startContainer,e.startOffset)}if(d.comparePoints(e.endContainer,e.endOffset,this.endContainer,this.endOffset)==1){ap.setEnd(e.endContainer,e.endOffset)}return ap}else{throw new S("Ranges do not intersect")}},containsNode:function(ap,e){if(e){return this.intersectsNode(ap,false)}else{return this.compareNode(ap)==m}},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,d.getNodeLength(e))<=0},containsRange:function(e){return this.intersection(e).equals(e)},containsNodeText:function(ar){var at=this.cloneRange();at.selectNode(ar);var aq=at.getNodes([3]);if(aq.length>0){at.setStart(aq[0],0);var e=aq.pop();at.setEnd(e,e.length);var ap=this.containsRange(at);at.detach();return ap}else{return this.containsNodeContents(ar)}},createNodeIterator:function(e,ap){j(this);return new y(this,e,ap)},getNodes:function(e,ap){j(this);return r(this,e,ap)},getDocument:function(){return o(this)},collapseBefore:function(e){E(this);this.setEndBefore(e);this.collapse(false)},collapseAfter:function(e){E(this);this.setStartAfter(e);this.collapse(true)},getName:function(){return"DomRange"},equals:function(e){return an.rangesEqual(this,e)},isValid:function(){return R(this)},inspect:function(){return B(this)}};function W(e){e.START_TO_START=n;e.START_TO_END=A;e.END_TO_END=aj;e.END_TO_START=ad;e.NODE_BEFORE=u;e.NODE_AFTER=x;e.NODE_BEFORE_AND_AFTER=M;e.NODE_INSIDE=m}function J(e){W(e);W(e.prototype)}function s(e,ap){return function(){j(this);var aw=this.startContainer,av=this.startOffset,aq=this.commonAncestorContainer;var at=new i(this,true);var au,ax;if(aw!==aq){au=d.getClosestAncestorIn(aw,aq,true);ax=aa(au);aw=ax.node;av=ax.offset}Z(at,ae);at.reset();var ar=e(at);at.detach();ap(this,aw,av,aw,av);return ar}}function ab(ar,av,e){function au(ax,aw){return function(ay){E(this);Y(ay,ai);Y(v(ay),ag);var az=(ax?C:aa)(ay);(aw?aq:at)(this,az.node,az.offset)}}function aq(ax,az,aA){var ay=ax.endContainer,aw=ax.endOffset;if(az!==ax.startContainer||aA!==ax.startOffset){if(v(az)!=v(ay)||d.comparePoints(az,aA,ay,aw)==1){ay=az;aw=aA}av(ax,az,aA,ay,aw)}}function at(aw,ax,aA){var az=aw.startContainer,ay=aw.startOffset;if(ax!==aw.endContainer||aA!==aw.endOffset){if(v(ax)!=v(az)||d.comparePoints(ax,aA,az,ay)==-1){az=ax;ay=aA}av(aw,az,ay,ax,aA)}}function ap(aw,ax,ay){if(ax!==aw.startContainer||ay!==aw.startOffset||ax!==aw.endContainer||ay!==aw.endOffset){av(aw,ax,ay,ax,ay)}}ar.prototype=new af();k.util.extend(ar.prototype,{setStart:function(aw,ax){E(this);t(aw,true);ah(aw,ax);aq(this,aw,ax)},setEnd:function(aw,ax){E(this);t(aw,true);ah(aw,ax);at(this,aw,ax)},setStartBefore:au(true,true),setStartAfter:au(false,true),setEndBefore:au(true,false),setEndAfter:au(false,false),collapse:function(aw){j(this);if(aw){av(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset)}else{av(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)}},selectNodeContents:function(aw){E(this);t(aw,true);av(this,aw,0,aw,d.getNodeLength(aw))},selectNode:function(ax){E(this);t(ax,false);Y(ax,ai);var ay=C(ax),aw=aa(ax);av(this,ay.node,ay.offset,aw.node,aw.offset)},extractContents:s(U,av),deleteContents:s(p,av),canSurroundContents:function(){j(this);ae(this.startContainer);ae(this.endContainer);var aw=new i(this,true);var ax=(aw._first&&(z(aw._first,this))||(aw._last&&z(aw._last,this)));aw.detach();return !ax},detach:function(){e(this)},splitBoundaries:function(){j(this);var aA=this.startContainer,az=this.startOffset,ax=this.endContainer,aw=this.endOffset;var ay=(aA===ax);if(d.isCharacterDataNode(ax)&&aw>0&&aw<ax.length){d.splitDataNode(ax,aw)}if(d.isCharacterDataNode(aA)&&az>0&&az<aA.length){aA=d.splitDataNode(aA,az);if(ay){aw-=az;ax=aA}else{if(ax==aA.parentNode&&aw>=d.getNodeIndex(aA)){aw++}}az=0}av(this,aA,az,ax,aw)},normalizeBoundaries:function(){j(this);var aD=this.startContainer,ay=this.startOffset,aC=this.endContainer,aw=this.endOffset;var az=function(aG){var aF=aG.nextSibling;if(aF&&aF.nodeType==aG.nodeType){aC=aG;aw=aG.length;aG.appendData(aF.data);aF.parentNode.removeChild(aF)}};var aE=function(aH){var aG=aH.previousSibling;if(aG&&aG.nodeType==aH.nodeType){aD=aH;var aF=aH.length;ay=aG.length;aH.insertData(0,aG.data);aG.parentNode.removeChild(aG);if(aD==aC){aw+=ay;aC=aD}else{if(aC==aH.parentNode){var aI=d.getNodeIndex(aH);if(aw==aI){aC=aH;aw=aF}else{if(aw>aI){aw--}}}}}};var aB=true;if(d.isCharacterDataNode(aC)){if(aC.length==aw){az(aC)}}else{if(aw>0){var aA=aC.childNodes[aw-1];if(aA&&d.isCharacterDataNode(aA)){az(aA)}}aB=!this.collapsed}if(aB){if(d.isCharacterDataNode(aD)){if(ay==0){aE(aD)}}else{if(ay<aD.childNodes.length){var ax=aD.childNodes[ay];if(ax&&d.isCharacterDataNode(ax)){aE(ax)}}}}else{aD=aC;ay=aw}av(this,aD,ay,aC,aw)},collapseToPoint:function(aw,ax){E(this);t(aw,true);ah(aw,ax);ap(this,aw,ax)}});J(ar)}function Q(e){e.collapsed=(e.startContainer===e.endContainer&&e.startOffset===e.endOffset);e.commonAncestorContainer=e.collapsed?e.startContainer:d.getCommonAncestor(e.startContainer,e.endContainer)}function G(aq,at,ap,au,ar){var e=(aq.startContainer!==at||aq.startOffset!==ap);var av=(aq.endContainer!==au||aq.endOffset!==ar);aq.startContainer=at;aq.startOffset=ap;aq.endContainer=au;aq.endOffset=ar;Q(aq);w(aq,"boundarychange",{startMoved:e,endMoved:av})}function am(e){E(e);e.startContainer=e.startOffset=e.endContainer=e.endOffset=null;e.collapsed=e.commonAncestorContainer=null;w(e,"detach",null);e._listeners=null}function an(e){this.startContainer=e;this.startOffset=0;this.endContainer=e;this.endOffset=0;this._listeners={boundarychange:[],detach:[]};Q(this)}ab(an,G,am);k.rangePrototype=af.prototype;an.rangeProperties=O;an.RangeIterator=i;an.copyComparisonConstants=J;an.createPrototypeRange=ab;an.inspect=B;an.getRangeDocument=o;an.rangesEqual=function(ap,e){return ap.startContainer===e.startContainer&&ap.startOffset===e.startOffset&&ap.endContainer===e.endContainer&&ap.endOffset===e.endOffset};k.DomRange=an;k.RangeException=S});rangy.createModule("WrappedRange",function(k,f){k.requireModules(["DomUtil","DomRange"]);var c;var j=k.dom;var d=j.DomPosition;var l=k.DomRange;function g(s){var q=s.parentElement();var o=s.duplicate();o.collapse(true);var r=o.parentElement();o=s.duplicate();o.collapse(false);var p=o.parentElement();var n=(r==p)?r:j.getCommonAncestor(r,p);return n==q?n:j.getCommonAncestor(q,n)}function e(n){return n.compareEndPoints("StartToEnd",n)==0}function h(B,y,p,u){var C=B.duplicate();C.collapse(p);var A=C.parentElement();if(!j.isAncestorOf(y,A,true)){A=y}if(!A.canHaveHTML){return new d(A.parentNode,j.getNodeIndex(A))}var o=j.getDocument(A).createElement("span");var z,w=p?"StartToStart":"StartToEnd";var x,s,n,q;do{A.insertBefore(o,o.previousSibling);C.moveToElementText(o)}while((z=C.compareEndPoints(w,B))>0&&o.previousSibling);q=o.nextSibling;if(z==-1&&q&&j.isCharacterDataNode(q)){C.setEndPoint(p?"EndToStart":"EndToEnd",B);var t;if(/[\r\n]/.test(q.data)){var v=C.duplicate();var r=v.text.replace(/\r\n/g,"\r").length;t=v.moveStart("character",r);while((z=v.compareEndPoints("StartToEnd",v))==-1){t++;v.moveStart("character",1)}}else{t=C.text.length}n=new d(q,t)}else{x=(u||!p)&&o.previousSibling;s=(u||p)&&o.nextSibling;if(s&&j.isCharacterDataNode(s)){n=new d(s,0)}else{if(x&&j.isCharacterDataNode(x)){n=new d(x,x.length)}else{n=new d(A,j.getNodeIndex(o))}}}o.parentNode.removeChild(o);return n}function m(n,p){var q,t,r=n.offset;var u=j.getDocument(n.node);var o,v,w=u.body.createTextRange();var s=j.isCharacterDataNode(n.node);if(s){q=n.node;t=q.parentNode}else{v=n.node.childNodes;q=(r<v.length)?v[r]:null;t=n.node}o=u.createElement("span");o.innerHTML="&#feff;";if(q){t.insertBefore(o,q)}else{t.appendChild(o)}w.moveToElementText(o);w.collapse(!p);t.removeChild(o);if(s){w[p?"moveStart":"moveEnd"]("character",r)}return w}if(k.features.implementsDomRange&&(!k.features.implementsTextRange||!k.config.preferTextRange)){(function(){var p;var u=l.rangeProperties;var x;function n(y){var z=u.length,A;while(z--){A=u[z];y[A]=y.nativeRange[A]}}function q(A,C,z,D,B){var y=(A.startContainer!==C||A.startOffset!=z);var E=(A.endContainer!==D||A.endOffset!=B);if(y||E){A.setEnd(D,B);A.setStart(C,z)}}function v(y){y.nativeRange.detach();y.detached=true;var z=u.length,A;while(z--){A=u[z];y[A]=null}}var o;c=function(y){if(!y){throw new Error("Range must be specified")}this.nativeRange=y;n(this)};l.createPrototypeRange(c,q,v);p=c.prototype;p.selectNode=function(y){this.nativeRange.selectNode(y);n(this)};p.deleteContents=function(){this.nativeRange.deleteContents();n(this)};p.extractContents=function(){var y=this.nativeRange.extractContents();n(this);return y};p.cloneContents=function(){return this.nativeRange.cloneContents()};p.surroundContents=function(y){this.nativeRange.surroundContents(y);n(this)};p.collapse=function(y){this.nativeRange.collapse(y);n(this)};p.cloneRange=function(){return new c(this.nativeRange.cloneRange())};p.refresh=function(){n(this)};p.toString=function(){return this.nativeRange.toString()};var t=document.createTextNode("test");j.getBody(document).appendChild(t);var r=document.createRange();r.setStart(t,0);r.setEnd(t,0);try{r.setStart(t,1);x=true;p.setStart=function(y,z){this.nativeRange.setStart(y,z);n(this)};p.setEnd=function(y,z){this.nativeRange.setEnd(y,z);n(this)};o=function(y){return function(z){this.nativeRange[y](z);n(this)}}}catch(s){x=false;p.setStart=function(z,A){try{this.nativeRange.setStart(z,A)}catch(y){this.nativeRange.setEnd(z,A);this.nativeRange.setStart(z,A)}n(this)};p.setEnd=function(z,A){try{this.nativeRange.setEnd(z,A)}catch(y){this.nativeRange.setStart(z,A);this.nativeRange.setEnd(z,A)}n(this)};o=function(y,z){return function(B){try{this.nativeRange[y](B)}catch(A){this.nativeRange[z](B);this.nativeRange[y](B)}n(this)}}}p.setStartBefore=o("setStartBefore","setEndBefore");p.setStartAfter=o("setStartAfter","setEndAfter");p.setEndBefore=o("setEndBefore","setStartBefore");p.setEndAfter=o("setEndAfter","setStartAfter");r.selectNodeContents(t);if(r.startContainer==t&&r.endContainer==t&&r.startOffset==0&&r.endOffset==t.length){p.selectNodeContents=function(y){this.nativeRange.selectNodeContents(y);n(this)}}else{p.selectNodeContents=function(y){this.setStart(y,0);this.setEnd(y,l.getEndOffset(y))}}r.selectNodeContents(t);r.setEnd(t,3);var w=document.createRange();w.selectNodeContents(t);w.setEnd(t,4);w.setStart(t,2);if(r.compareBoundaryPoints(r.START_TO_END,w)==-1&r.compareBoundaryPoints(r.END_TO_START,w)==1){p.compareBoundaryPoints=function(z,y){y=y.nativeRange||y;if(z==y.START_TO_END){z=y.END_TO_START}else{if(z==y.END_TO_START){z=y.START_TO_END}}return this.nativeRange.compareBoundaryPoints(z,y)}}else{p.compareBoundaryPoints=function(z,y){return this.nativeRange.compareBoundaryPoints(z,y.nativeRange||y)}}if(k.util.isHostMethod(r,"createContextualFragment")){p.createContextualFragment=function(y){return this.nativeRange.createContextualFragment(y)}}j.getBody(document).removeChild(t);r.detach();w.detach()})();k.createNativeRange=function(n){n=n||document;return n.createRange()}}else{if(k.features.implementsTextRange){c=function(n){this.textRange=n;this.refresh()};c.prototype=new l(document);c.prototype.refresh=function(){var p,n;var o=g(this.textRange);if(e(this.textRange)){n=p=h(this.textRange,o,true,true)}else{p=h(this.textRange,o,true,false);n=h(this.textRange,o,false,false)}this.setStart(p.node,p.offset);this.setEnd(n.node,n.offset)};l.copyComparisonConstants(c);var i=(function(){return this})();if(typeof i.Range=="undefined"){i.Range=c}k.createNativeRange=function(n){n=n||document;return n.body.createTextRange()}}}if(k.features.implementsTextRange){c.rangeToTextRange=function(n){if(n.collapsed){var q=m(new d(n.startContainer,n.startOffset),true);return q}else{var r=m(new d(n.startContainer,n.startOffset),true);var p=m(new d(n.endContainer,n.endOffset),false);var o=j.getDocument(n.startContainer).body.createTextRange();o.setEndPoint("StartToStart",r);o.setEndPoint("EndToEnd",p);return o}}}c.prototype.getName=function(){return"WrappedRange"};k.WrappedRange=c;k.createRange=function(n){n=n||document;return new c(k.createNativeRange(n))};k.createRangyRange=function(n){n=n||document;return new l(n)};k.createIframeRange=function(n){return k.createRange(j.getIframeDocument(n))};k.createIframeRangyRange=function(n){return k.createRangyRange(j.getIframeDocument(n))};k.addCreateMissingNativeApiListener(function(o){var n=o.document;if(typeof n.createRange=="undefined"){n.createRange=function(){return k.createRange(this)}}n=o=null})});rangy.createModule("WrappedSelection",function(i,f){i.requireModules(["DomUtil","DomRange","WrappedRange"]);i.config.checkSelectionRanges=true;var G="boolean",W="_rangySelection",e=i.dom,n=i.util,T=i.DomRange,g=i.WrappedRange,Q=i.DOMException,A=e.DomPosition,y,p,X="Control";function o(Z){return(Z||window).getSelection()}function s(Z){return(Z||window).document.selection}var V=i.util.isHostMethod(window,"getSelection"),P=i.util.isHostObject(document,"selection");var w=P&&(!V||i.config.preferTextRange);if(w){y=s;i.isSelectionValid=function(aa){var ab=(aa||window).document,Z=ab.selection;return(Z.type!="None"||e.getDocument(Z.createRange().parentElement())==ab)}}else{if(V){y=o;i.isSelectionValid=function(){return true}}else{f.fail("Neither document.selection or window.getSelection() detected.")}}i.getNativeSelection=y;var O=y();var D=i.createNativeRange(document);var E=e.getBody(document);var M=n.areHostObjects(O,["anchorNode","focusNode"]&&n.areHostProperties(O,["anchorOffset","focusOffset"]));i.features.selectionHasAnchorAndFocus=M;var r=n.isHostMethod(O,"extend");i.features.selectionHasExtend=r;var Y=(typeof O.rangeCount=="number");i.features.selectionHasRangeCount=Y;var S=false;var R=true;if(n.areHostMethods(O,["addRange","getRangeAt","removeAllRanges"])&&typeof O.rangeCount=="number"&&i.features.implementsDomRange){(function(){var ab=document.createElement("iframe");ab.frameBorder=0;ab.style.position="absolute";ab.style.left="-10000px";E.appendChild(ab);var af=e.getIframeDocument(ab);af.open();af.write("<html><head></head><body>12</body></html>");af.close();var ad=e.getIframeWindow(ab).getSelection();var ag=af.documentElement;var ac=ag.lastChild,ae=ac.firstChild;var aa=af.createRange();aa.setStart(ae,1);aa.collapse(true);ad.addRange(aa);R=(ad.rangeCount==1);ad.removeAllRanges();var Z=aa.cloneRange();aa.setStart(ae,0);Z.setEnd(ae,2);ad.addRange(aa);ad.addRange(Z);S=(ad.rangeCount==2);aa.detach();Z.detach();E.removeChild(ab)})()}i.features.selectionSupportsMultipleRanges=S;i.features.collapsedNonEditableSelectionsSupported=R;var h=false,l;if(E&&n.isHostMethod(E,"createControlRange")){l=E.createControlRange();if(n.areHostProperties(l,["item","add"])){h=true}}i.features.implementsControlRange=h;if(M){p=function(Z){return Z.anchorNode===Z.focusNode&&Z.anchorOffset===Z.focusOffset}}else{p=function(Z){return Z.rangeCount?Z.getRangeAt(Z.rangeCount-1).collapsed:false}}function d(ac,aa,Z){var ab=Z?"end":"start",ad=Z?"start":"end";ac.anchorNode=aa[ab+"Container"];ac.anchorOffset=aa[ab+"Offset"];ac.focusNode=aa[ad+"Container"];ac.focusOffset=aa[ad+"Offset"]}function x(aa){var Z=aa.nativeSelection;aa.anchorNode=Z.anchorNode;aa.anchorOffset=Z.anchorOffset;aa.focusNode=Z.focusNode;aa.focusOffset=Z.focusOffset}function J(Z){Z.anchorNode=Z.focusNode=null;Z.anchorOffset=Z.focusOffset=0;Z.rangeCount=0;Z.isCollapsed=true;Z._ranges.length=0}function L(Z){var aa;if(Z instanceof T){aa=Z._selectionNativeRange;if(!aa){aa=i.createNativeRange(e.getDocument(Z.startContainer));aa.setEnd(Z.endContainer,Z.endOffset);aa.setStart(Z.startContainer,Z.startOffset);Z._selectionNativeRange=aa;Z.attachListener("detach",function(){this._selectionNativeRange=null})}}else{if(Z instanceof g){aa=Z.nativeRange}else{if(i.features.implementsDomRange&&(Z instanceof e.getWindow(Z.startContainer).Range)){aa=Z}}}return aa}function m(ab){if(!ab.length||ab[0].nodeType!=1){return false}for(var aa=1,Z=ab.length;aa<Z;++aa){if(!e.isAncestorOf(ab[0],ab[aa])){return false}}return true}function N(aa){var Z=aa.getNodes();if(!m(Z)){throw new Error("getSingleElementFromRange: range "+aa.inspect()+" did not consist of a single element")}return Z[0]}function I(Z){return !!Z&&typeof Z.text!="undefined"}function K(ab,aa){var Z=new g(aa);ab._ranges=[Z];d(ab,Z,false);ab.rangeCount=1;ab.isCollapsed=Z.collapsed}function v(ac){ac._ranges.length=0;if(ac.docSelection.type=="None"){J(ac)}else{var ab=ac.docSelection.createRange();if(I(ab)){K(ac,ab)}else{ac.rangeCount=ab.length;var Z,ad=e.getDocument(ab.item(0));for(var aa=0;aa<ac.rangeCount;++aa){Z=i.createRange(ad);Z.selectNode(ab.item(aa));ac._ranges.push(Z)}ac.isCollapsed=ac.rangeCount==1&&ac._ranges[0].collapsed;d(ac,ac._ranges[ac.rangeCount-1],false)}}}function z(aa,ad){var ab=aa.docSelection.createRange();var Z=N(ad);var ah=e.getDocument(ab.item(0));var ae=e.getBody(ah).createControlRange();for(var ac=0,af=ab.length;ac<af;++ac){ae.add(ab.item(ac))}try{ae.add(Z)}catch(ag){throw new Error("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}ae.select();v(aa)}var q;if(n.isHostMethod(O,"getRangeAt")){q=function(ab,Z){try{return ab.getRangeAt(Z)}catch(aa){return null}}}else{if(M){q=function(aa){var ab=e.getDocument(aa.anchorNode);var Z=i.createRange(ab);Z.setStart(aa.anchorNode,aa.anchorOffset);Z.setEnd(aa.focusNode,aa.focusOffset);if(Z.collapsed!==this.isCollapsed){Z.setStart(aa.focusNode,aa.focusOffset);Z.setEnd(aa.anchorNode,aa.anchorOffset)}return Z}}}function C(Z,ab,aa){this.nativeSelection=Z;this.docSelection=ab;this._ranges=[];this.win=aa;this.refresh()}i.getSelection=function(ab){ab=ab||window;var aa=ab[W];var Z=y(ab),ac=P?s(ab):null;if(aa){aa.nativeSelection=Z;aa.docSelection=ac;aa.refresh(ab)}else{aa=new C(Z,ac,ab);ab[W]=aa}return aa};i.getIframeSelection=function(Z){return i.getSelection(e.getIframeWindow(Z))};var c=C.prototype;function k(ae,Z){var af=e.getDocument(Z[0].startContainer);var ac=e.getBody(af).createControlRange();for(var ab=0,ad;ab<rangeCount;++ab){ad=N(Z[ab]);try{ac.add(ad)}catch(aa){throw new Error("setRanges(): Element within the one of the specified Ranges could not be added to control selection (does it have layout?)")}}ac.select();v(ae)}if(!w&&M&&n.areHostMethods(O,["removeAllRanges","addRange"])){c.removeAllRanges=function(){this.nativeSelection.removeAllRanges();J(this)};var j=function(ab,Z){var ac=T.getRangeDocument(Z);var aa=i.createRange(ac);aa.collapseToPoint(Z.endContainer,Z.endOffset);ab.nativeSelection.addRange(L(aa));ab.nativeSelection.extend(Z.startContainer,Z.startOffset);ab.refresh()};if(Y){c.addRange=function(aa,Z){if(h&&P&&this.docSelection.type==X){z(this,aa)}else{if(Z&&r){j(this,aa)}else{var ab;if(S){ab=this.rangeCount}else{this.removeAllRanges();ab=0}this.nativeSelection.addRange(L(aa));this.rangeCount=this.nativeSelection.rangeCount;if(this.rangeCount==ab+1){if(i.config.checkSelectionRanges){var ac=q(this.nativeSelection,this.rangeCount-1);if(ac&&!T.rangesEqual(ac,aa)){aa=new g(ac)}}this._ranges[this.rangeCount-1]=aa;d(this,aa,t(this.nativeSelection));this.isCollapsed=p(this)}else{this.refresh()}}}}}else{c.addRange=function(aa,Z){if(Z&&r){j(this,aa)}else{this.nativeSelection.addRange(L(aa));this.refresh()}}}c.setRanges=function(aa){if(h&&aa.length>1){k(this,aa)}else{this.removeAllRanges();for(var ab=0,Z=aa.length;ab<Z;++ab){this.addRange(aa[ab])}}}}else{if(n.isHostMethod(O,"empty")&&n.isHostMethod(D,"select")&&h&&w){c.removeAllRanges=function(){try{this.docSelection.empty();if(this.docSelection.type!="None"){var ac;if(this.anchorNode){ac=e.getDocument(this.anchorNode)}else{if(this.docSelection.type==X){var aa=this.docSelection.createRange();if(aa.length){ac=e.getDocument(aa.item(0)).body.createTextRange()}}}if(ac){var ab=ac.body.createTextRange();ab.select();this.docSelection.empty()}}}catch(Z){}J(this)};c.addRange=function(Z){if(this.docSelection.type==X){z(this,Z)}else{g.rangeToTextRange(Z).select();this._ranges[0]=Z;this.rangeCount=1;this.isCollapsed=this._ranges[0].collapsed;d(this,Z,false)}};c.setRanges=function(Z){this.removeAllRanges();var aa=Z.length;if(aa>1){k(this,Z)}else{if(aa){this.addRange(Z[0])}}}}else{f.fail("No means of selecting a Range or TextRange was found");return false}}c.getRangeAt=function(Z){if(Z<0||Z>=this.rangeCount){throw new Q("INDEX_SIZE_ERR")}else{return this._ranges[Z]}};var H;if(w){H=function(aa){var Z;if(i.isSelectionValid(aa.win)){Z=aa.docSelection.createRange()}else{Z=e.getBody(aa.win.document).createTextRange();Z.collapse(true)}if(aa.docSelection.type==X){v(aa)}else{if(I(Z)){K(aa,Z)}else{J(aa)}}}}else{if(n.isHostMethod(O,"getRangeAt")&&typeof O.rangeCount=="number"){H=function(ab){if(h&&P&&ab.docSelection.type==X){v(ab)}else{ab._ranges.length=ab.rangeCount=ab.nativeSelection.rangeCount;if(ab.rangeCount){for(var aa=0,Z=ab.rangeCount;aa<Z;++aa){ab._ranges[aa]=new i.WrappedRange(ab.nativeSelection.getRangeAt(aa))}d(ab,ab._ranges[ab.rangeCount-1],t(ab.nativeSelection));ab.isCollapsed=p(ab)}else{J(ab)}}}}else{if(M&&typeof O.isCollapsed==G&&typeof D.collapsed==G&&i.features.implementsDomRange){H=function(ab){var Z,aa=ab.nativeSelection;if(aa.anchorNode){Z=q(aa,0);ab._ranges=[Z];ab.rangeCount=1;x(ab);ab.isCollapsed=p(ab)}else{J(ab)}}}else{f.fail("No means of obtaining a Range or TextRange from the user's selection was found");return false}}}c.refresh=function(aa){var Z=aa?this._ranges.slice(0):null;H(this);if(aa){var ab=Z.length;if(ab!=this._ranges.length){return false}while(ab--){if(!T.rangesEqual(Z[ab],this._ranges[ab])){return false}}return true}};var B=function(ad,ab){var aa=ad.getAllRanges(),ae=false;ad.removeAllRanges();for(var ac=0,Z=aa.length;ac<Z;++ac){if(ae||ab!==aa[ac]){ad.addRange(aa[ac])}else{ae=true}}if(!ad.rangeCount){J(ad)}};if(h){c.removeRange=function(ad){if(this.docSelection.type==X){var ab=this.docSelection.createRange();var Z=N(ad);var ah=e.getDocument(ab.item(0));var af=e.getBody(ah).createControlRange();var aa,ag=false;for(var ac=0,ae=ab.length;ac<ae;++ac){aa=ab.item(ac);if(aa!==Z||ag){af.add(ab.item(ac))}else{ag=true}}af.select();v(this)}else{B(this,ad)}}}else{c.removeRange=function(Z){B(this,Z)}}var t;if(!w&&M&&i.features.implementsDomRange){t=function(aa){var Z=false;if(aa.anchorNode){Z=(e.comparePoints(aa.anchorNode,aa.anchorOffset,aa.focusNode,aa.focusOffset)==1)}return Z};c.isBackwards=function(){return t(this)}}else{t=c.isBackwards=function(){return false}}c.toString=function(){var ab=[];for(var aa=0,Z=this.rangeCount;aa<Z;++aa){ab[aa]=""+this._ranges[aa]}return ab.join("")};function U(aa,Z){if(aa.anchorNode&&(e.getDocument(aa.anchorNode)!==e.getDocument(Z))){throw new Q("WRONG_DOCUMENT_ERR")}}c.collapse=function(aa,ab){U(this,aa);var Z=i.createRange(e.getDocument(aa));Z.collapseToPoint(aa,ab);this.removeAllRanges();this.addRange(Z);this.isCollapsed=true};c.collapseToStart=function(){if(this.rangeCount){var Z=this._ranges[0];this.collapse(Z.startContainer,Z.startOffset)}else{throw new Q("INVALID_STATE_ERR")}};c.collapseToEnd=function(){if(this.rangeCount){var Z=this._ranges[this.rangeCount-1];this.collapse(Z.endContainer,Z.endOffset)}else{throw new Q("INVALID_STATE_ERR")}};c.selectAllChildren=function(aa){U(this,aa);var Z=i.createRange(e.getDocument(aa));Z.selectNodeContents(aa);this.removeAllRanges();this.addRange(Z)};c.deleteFromDocument=function(){if(h&&P&&this.docSelection.type==X){var ad=this.docSelection.createRange();var ac;while(ad.length){ac=ad.item(0);ad.remove(ac);ac.parentNode.removeChild(ac)}this.refresh()}else{if(this.rangeCount){var aa=this.getAllRanges();this.removeAllRanges();for(var ab=0,Z=aa.length;ab<Z;++ab){aa[ab].deleteContents()}this.addRange(aa[Z-1])}}};c.getAllRanges=function(){return this._ranges.slice(0)};c.setSingleRange=function(Z){this.setRanges([Z])};c.containsNode=function(ac,aa){for(var ab=0,Z=this._ranges.length;ab<Z;++ab){if(this._ranges[ab].containsNode(ac,aa)){return true}}return false};c.toHtml=function(){var ac="";if(this.rangeCount){var aa=T.getRangeDocument(this._ranges[0]).createElement("div");for(var ab=0,Z=this._ranges.length;ab<Z;++ab){aa.appendChild(this._ranges[ab].cloneContents())}ac=aa.innerHTML}return ac};function u(af){var ae=[];var ac=new A(af.anchorNode,af.anchorOffset);var aa=new A(af.focusNode,af.focusOffset);var ab=(typeof af.getName=="function")?af.getName():"Selection";if(typeof af.rangeCount!="undefined"){for(var ad=0,Z=af.rangeCount;ad<Z;++ad){ae[ad]=T.inspect(af.getRangeAt(ad))}}return"["+ab+"(Ranges: "+ae.join(", ")+")(anchor: "+ac.inspect()+", focus: "+aa.inspect()+"]"}c.getName=function(){return"WrappedSelection"};c.inspect=function(){return u(this)};c.detach=function(){this.win[W]=null;this.win=this.anchorNode=this.focusNode=null};C.inspect=u;i.Selection=C;i.selectionPrototype=c;i.addCreateMissingNativeApiListener(function(Z){if(typeof Z.getSelection=="undefined"){Z.getSelection=function(){return i.getSelection(this)}}Z=null})});rangy.createModule("CssClassApplier",function(i,g){i.requireModules(["WrappedSelection","WrappedRange"]);var d=i.dom;var B="span";function c(N){return N.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function G(O,N){return O.className&&new RegExp("(?:^|\\s)"+N+"(?:\\s|$)").test(O.className)}function t(O,N){if(O.className){if(!G(O,N)){O.className+=" "+N}}else{O.className=N}}var o=(function(){function N(O,Q,P){return(Q&&P)?" ":""}return function(P,O){if(P.className){P.className=P.className.replace(new RegExp("(?:^|\\s)"+O+"(?:\\s|$)"),N)}}})();function x(N){return N.split(/\s+/).sort().join(" ")}function u(N){return x(N.className)}function n(O,N){return u(O)==u(N)}function w(O){var N=O.parentNode;while(O.hasChildNodes()){N.insertBefore(O.firstChild,O)}N.removeChild(O)}function y(N,R){var O=N.cloneRange();O.selectNodeContents(R);var P=O.intersection(N);var Q=P?P.toString():"";O.detach();return Q!=""}function D(N){return N.getNodes([3],function(O){return y(N,O)})}function J(T,R){if(T.attributes.length!=R.attributes.length){return false}for(var S=0,N=T.attributes.length,Q,O,P;S<N;++S){Q=T.attributes[S];P=Q.name;if(P!="class"){O=R.attributes.getNamedItem(P);if(Q.specified!=O.specified){return false}if(Q.specified&&Q.nodeValue!==O.nodeValue){return false}}}return true}function K(R,Q){for(var P=0,N=R.attributes.length,O;P<N;++P){O=R.attributes[P].name;if(!(Q&&d.arrayContains(Q,O))&&R.attributes[P].specified&&O!="class"){return true}}return false}function M(O,N){for(var P in N){if(N.hasOwnProperty(P)&&O[P]!==N[P]){return false}}return true}var p;if(typeof window.getComputedStyle!="undefined"){p=function(N,O){return d.getWindow(N).getComputedStyle(N,null)[O]}}else{if(typeof document.documentElement.currentStyle!="undefined"){p=function(N,O){return N.currentStyle[O]}}else{g.fail("No means of obtaining computed style properties found")}}var r;(function(){var N=document.createElement("div");if(typeof N.isContentEditable=="boolean"){r=function(O){return O&&O.nodeType==1&&O.isContentEditable}}else{r=function(O){if(!O||O.nodeType!=1||O.contentEditable=="false"){return false}return O.contentEditable=="true"||r(O.parentNode)}}})();function f(O){var N;return O&&O.nodeType==1&&(((N=O.parentNode)&&N.nodeType==9&&N.designMode=="on")||(r(O)&&!r(O.parentNode)))}function e(N){return(r(N)||(N.nodeType!=1&&r(N.parentNode)))&&!f(N)}var I=/^inline(-block|-table)?$/i;function h(N){return N&&N.nodeType==1&&!I.test(p(N,"display"))}var k=/[^\r\n\t\f \u200B]/;function E(N){if(N.data.length==0){return true}if(k.test(N.data)){return false}var O=p(N.parentNode,"whiteSpace");switch(O){case"pre":case"pre-wrap":case"-moz-pre-wrap":return false;case"pre-line":if(/[\r\n]/.test(N.data)){return false}}return h(N.previousSibling)||h(N.nextSibling)}function C(N,O){if(d.isCharacterDataNode(N)){if(O==0){return !!N.previousSibling}else{if(O==N.length){return !!N.nextSibling}else{return true}}}return O>0&&O<N.childNodes.length}function H(S,P,R,T){var O;var N=(R==0);if(d.isAncestorOf(P,S)){return S}if(d.isCharacterDataNode(P)){if(R==0){R=d.getNodeIndex(P);P=P.parentNode}else{if(R==P.length){R=d.getNodeIndex(P)+1;P=P.parentNode}else{throw g.createError("splitNodeAt should not be called with offset in the middle of a data node ("+R+" in "+P.data)}}}if(C(P,R)){if(!O){O=P.cloneNode(false);if(O.id){O.removeAttribute("id")}var U;while((U=P.childNodes[R])){O.appendChild(U)}d.insertAfter(O,P)}return(P==S)?O:H(S,O.parentNode,d.getNodeIndex(O),T)}else{if(S!=P){O=P.parentNode;var Q=d.getNodeIndex(P);if(!N){Q++}return H(S,O,Q,T)}}return S}function L(O,N){return O.tagName==N.tagName&&n(O,N)&&J(O,N)}function q(N){var O=N?"nextSibling":"previousSibling";return function(S,P){var Q=S.parentNode;var R=S[O];if(R){if(R&&R.nodeType==3){return R}}else{if(P){R=Q[O];if(R&&R.nodeType==1&&L(Q,R)){return R[N?"firstChild":"lastChild"]}}}return null}}var s=q(false),m=q(true);function v(N){this.isElementMerge=(N.nodeType==1);this.firstTextNode=this.isElementMerge?N.lastChild:N;this.textNodes=[this.firstTextNode]}v.prototype={doMerge:function(){var S=[],R,P,Q;for(var O=0,N=this.textNodes.length;O<N;++O){R=this.textNodes[O];P=R.parentNode;S[O]=R.data;if(O){P.removeChild(R);if(!P.hasChildNodes()){P.parentNode.removeChild(P)}}}this.firstTextNode.data=Q=S.join("");return Q},getLength:function(){var O=this.textNodes.length,N=0;while(O--){N+=this.textNodes[O].length}return N},toString:function(){var P=[];for(var O=0,N=this.textNodes.length;O<N;++O){P[O]="'"+this.textNodes[O].data+"'"}return"[Merge("+P.join(",")+")]"}};var z=["elementTagName","ignoreWhiteSpace","applyToEditableOnly"];var A={"class":"className"};function j(X,W,V){this.cssClass=X;var R,Q,T,S;var P=null;if(typeof W=="object"&&W!==null){V=W.tagNames;P=W.elementProperties;for(Q=0;S=z[Q++];){if(W.hasOwnProperty(S)){this[S]=W[S]}}R=W.normalize}else{R=W}this.normalize=(typeof R=="undefined")?true:R;this.attrExceptions=[];var O=document.createElement(this.elementTagName);this.elementProperties={};for(var N in P){if(P.hasOwnProperty(N)){if(A.hasOwnProperty(N)){N=A[N]}O[N]=P[N];this.elementProperties[N]=O[N];this.attrExceptions.push(N)}}this.elementSortedClassName=this.elementProperties.hasOwnProperty("className")?x(this.elementProperties.className+" "+X):X;this.applyToAnyTagName=false;var U=typeof V;if(U=="string"){if(V=="*"){this.applyToAnyTagName=true}else{this.tagNames=c(V.toLowerCase()).split(/\s*,\s*/)}}else{if(U=="object"&&typeof V.length=="number"){this.tagNames=[];for(Q=0,T=V.length;Q<T;++Q){if(V[Q]=="*"){this.applyToAnyTagName=true}else{this.tagNames.push(V[Q].toLowerCase())}}}else{this.tagNames=[this.elementTagName]}}}j.prototype={elementTagName:B,elementProperties:{},ignoreWhiteSpace:true,applyToEditableOnly:false,hasClass:function(N){return N.nodeType==1&&d.arrayContains(this.tagNames,N.tagName.toLowerCase())&&G(N,this.cssClass)},getSelfOrAncestorWithClass:function(N){while(N){if(this.hasClass(N,this.cssClass)){return N}N=N.parentNode}return null},isModifiable:function(N){return !this.applyToEditableOnly||e(N)},isIgnorableWhiteSpaceNode:function(N){return this.ignoreWhiteSpace&&N&&N.nodeType==3&&E(N)},postApply:function(aa,W,S){var N=aa[0],O=aa[aa.length-1];var Q=[],ab;var T=N,P=O;var Y=0,ac=O.length;var R,V;for(var U=0,X=aa.length;U<X;++U){R=aa[U];V=s(R,!S);if(V){if(!ab){ab=new v(V);Q.push(ab)}ab.textNodes.push(R);if(R===N){T=ab.firstTextNode;Y=T.length}if(R===O){P=ab.firstTextNode;ac=ab.getLength()}}else{ab=null}}var Z=m(O,!S);if(Z){if(!ab){ab=new v(O);Q.push(ab)}ab.textNodes.push(Z)}if(Q.length){for(U=0,X=Q.length;U<X;++U){Q[U].doMerge()}W.setStart(T,Y);W.setEnd(P,ac)}},createContainer:function(O){var N=O.createElement(this.elementTagName);i.util.extend(N,this.elementProperties);t(N,this.cssClass);return N},applyToTextNode:function(P){var O=P.parentNode;if(O.childNodes.length==1&&d.arrayContains(this.tagNames,O.tagName.toLowerCase())){t(O,this.cssClass)}else{var N=this.createContainer(d.getDocument(P));P.parentNode.insertBefore(N,P);N.appendChild(P)}},isRemovable:function(N){return N.tagName.toLowerCase()==this.elementTagName&&u(N)==this.elementSortedClassName&&M(N,this.elementProperties)&&!K(N,this.attrExceptions)&&this.isModifiable(N)},undoToTextNode:function(Q,O,P){if(!O.containsNode(P)){var N=O.cloneRange();N.selectNode(P);if(N.isPointInRange(O.endContainer,O.endOffset)){H(P,O.endContainer,O.endOffset,[O]);O.setEndAfter(P)}if(N.isPointInRange(O.startContainer,O.startOffset)){P=H(P,O.startContainer,O.startOffset,[O])}}if(this.isRemovable(P)){w(P)}else{o(P,this.cssClass)}},applyToRange:function(O){O.splitBoundaries();var Q=D(O);if(Q.length){var R;for(var P=0,N=Q.length;P<N;++P){R=Q[P];if(!this.isIgnorableWhiteSpaceNode(R)&&!this.getSelfOrAncestorWithClass(R)&&this.isModifiable(R)){this.applyToTextNode(R)}}O.setStart(Q[0],0);R=Q[Q.length-1];O.setEnd(R,R.length);if(this.normalize){this.postApply(Q,O,false)}}},applyToSelection:function(R){R=R||window;var Q=i.getSelection(R);var O,N=Q.getAllRanges();Q.removeAllRanges();var P=N.length;while(P--){O=N[P];this.applyToRange(O);Q.addRange(O)}},undoToRange:function(P){P.splitBoundaries();var R=D(P);var T,S;var O=R[R.length-1];if(R.length){for(var Q=0,N=R.length;Q<N;++Q){T=R[Q];S=this.getSelfOrAncestorWithClass(T);if(S&&this.isModifiable(T)){this.undoToTextNode(T,P,S)}P.setStart(R[0],0);P.setEnd(O,O.length)}if(this.normalize){this.postApply(R,P,true)}}},undoToSelection:function(S){S=S||window;var R=i.getSelection(S);var O=R.getAllRanges(),P;R.removeAllRanges();for(var Q=0,N=O.length;Q<N;++Q){P=O[Q];this.undoToRange(P);R.addRange(P)}},getTextSelectedByRange:function(R,N){var O=N.cloneRange();O.selectNodeContents(R);var P=O.intersection(N);var Q=P?P.toString():"";O.detach();return Q},isAppliedToRange:function(N){if(N.collapsed){return !!this.getSelfOrAncestorWithClass(N.commonAncestorContainer)}else{var P=N.getNodes([3]);for(var O=0,Q;Q=P[O++];){if(!this.isIgnorableWhiteSpaceNode(Q)&&y(N,Q)&&this.isModifiable(Q)&&!this.getSelfOrAncestorWithClass(Q)){return false}}return true}},isAppliedToSelection:function(Q){Q=Q||window;var P=i.getSelection(Q);var N=P.getAllRanges();var O=N.length;while(O--){if(!this.isAppliedToRange(N[O])){return false}}return true},toggleRange:function(N){if(this.isAppliedToRange(N)){this.undoToRange(N)}else{this.applyToRange(N)}},toggleSelection:function(N){if(this.isAppliedToSelection(N)){this.undoToSelection(N)}else{this.applyToSelection(N)}},detach:function(){}};function l(O,P,N){return new j(O,P,N)}j.util={hasClass:G,addClass:t,removeClass:o,hasSameClasses:n,replaceWithOwnChildren:w,elementsHaveSameNonClassAttributes:J,elementHasNonClassAttributes:K,splitNodeAt:H,isEditableElement:r,isEditingHost:f,isEditable:e};i.CssClassApplier=j;i.createCssClassApplier=l;d.hasClass=G});rangy.createModule("SaveRestore",function(j,g){j.requireModules(["DomUtil","DomRange","WrappedRange"]);var i=j.dom;var d="\ufeff";function n(p,o){return(o||document).getElementById(p)}function e(q,o){var r="selectionBoundary_"+(+new Date())+"_"+(""+Math.random()).slice(2);var p;var t=i.getDocument(q.startContainer);var s=q.cloneRange();s.collapse(o);p=t.createElement("span");p.id=r;p.style.lineHeight="0";p.style.display="none";p.className="rangySelectionBoundary";p.appendChild(t.createTextNode(d));s.insertNode(p);s.detach();return p}function m(s,q,r,o){var p=n(r,s);if(p){q[o?"setStartBefore":"setEndBefore"](p);p.parentNode.removeChild(p)}else{g.warn("Marker element has been removed. Cannot restore selection.")}}function f(p,o){return o.compareBoundaryPoints(p.START_TO_START,p)}function h(v){v=v||window;var x=v.document;if(!j.isSelectionValid(v)){g.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus.");return}var p=j.getSelection(v);var o=p.getAllRanges();var t=[],r,w,s;o.sort(f);for(var q=0,u=o.length;q<u;++q){s=o[q];if(s.collapsed){w=e(s,false);t.push({markerId:w.id,collapsed:true})}else{w=e(s,false);r=e(s,true);t[q]={startMarkerId:r.id,endMarkerId:w.id,collapsed:false,backwards:o.length==1&&p.isBackwards()}}}for(q=u-1;q>=0;--q){s=o[q];if(s.collapsed){s.collapseBefore(n(t[q].markerId,x))}else{s.setEndBefore(n(t[q].endMarkerId,x));s.setStartAfter(n(t[q].startMarkerId,x))}}p.setRanges(o);return{win:v,doc:x,rangeInfos:t,restored:false}}function c(y,q){if(!y.restored){var t=y.rangeInfos;var p=j.getSelection(y.win);var o=[];for(var v=t.length,r=v-1,x,s;r>=0;--r){x=t[r];s=j.createRange(y.doc);if(x.collapsed){var u=n(x.markerId,y.doc);if(u){u.style.display="inline";var w=u.previousSibling;if(w&&w.nodeType==3){u.parentNode.removeChild(u);s.collapseToPoint(w,w.length)}else{s.collapseBefore(u);u.parentNode.removeChild(u)}}else{g.warn("Marker element has been removed. Cannot restore selection.")}}else{m(y.doc,s,x.startMarkerId,true);m(y.doc,s,x.endMarkerId,false)}if(v==1){s.normalizeBoundaries()}o[r]=s}if(v==1&&q&&j.features.selectionHasExtend&&t[0].backwards){p.removeAllRanges();p.addRange(o[0],true)}else{p.setRanges(o)}y.restored=true}}function k(q,p){var o=n(p,q);if(o){o.parentNode.removeChild(o)}}function l(p){var s=p.rangeInfos;for(var r=0,o=s.length,q;r<o;++r){q=s[r];if(q.collapsed){k(p.doc,q.markerId)}else{k(p.doc,q.startMarkerId);k(p.doc,q.endMarkerId)}}}j.saveSelection=h;j.restoreSelection=c;j.removeMarkerElement=k;j.removeMarkers=l});return a},[]);